<!doctype html>
<html lang="cs">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>BALP v2</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="./css/app.css" rel="stylesheet">

  <style id="vp-fixes">
    #vpModal .modal-header #vp-actions{display:none !important;}
  </style>
</head>
<body class="bg-light">
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">BALP v2</a>
    <div class="d-flex ms-auto align-items-center gap-2">
      <span id="user-info" class="navbar-text text-white-50">Nepřihlášen</span>
      <button id="btn-login" type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#loginModal">Přihlásit</button>
      <button id="btn-logout" type="button" class="btn btn-outline-light btn-sm d-none">Odhlásit</button>
    </div>
  </div>
</nav>

<div class="container py-3">
  <div id="alert-box" class="alert d-none" role="alert"></div>

  <div class="card shadow-sm">
    <div class="card-body">
      <ul class="nav nav-tabs" id="mainTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="tab-pol" data-bs-toggle="tab" data-bs-target="#pane-pol" type="button" role="tab">Polotovary</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="tab-suroviny" data-bs-toggle="tab" data-bs-target="#pane-suroviny" type="button" role="tab">Suroviny</button>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="users-tab"
                data-bs-toggle="tab"
                href="#tab-users"
                data-bs-target="#tab-users"
                role="tab"
                aria-controls="tab-users"
                aria-selected="false">Uživatelé</a>
        </li>
        </ul>
    <!-- TAB PANES -->
    <div class="tab-content" id="mainTabsContent">
        <div class="tab-pane fade" id="tab-users" role="tabpanel" aria-labelledby="users-tab">
        <div class="p-3 text-muted">Načítám…</div>
        </div>
    </div>
    
      <div class="tab-content p-3" id="tabContent">
        <div class="tab-pane fade" id="pane-recipes" role="tabpanel">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0">Receptury</h5>
            <button class="btn btn-sm btn-outline-secondary" id="btn-reload">Obnovit</button>
          </div>
          <div id="recipes-list" class="small text-muted">Přihlaste se pro načtení dat…</div>
        </div>
        <div class="tab-pane fade" id="pane-dicts" role="tabpanel">
          <div id="dicts-list" class="small text-muted">Přihlaste se pro načtení dat…</div>
        </div>
        <div class="tab-pane fade" id="pane-prices" role="tabpanel">
          <div id="prices-list" class="small text-muted">Přihlaste se pro načtení dat…</div>
        </div>
        <div class="tab-pane fade" id="pane-tables" role="tabpanel">
          <div id="tables-list" class="small text-muted">Přihlaste se pro načtení dat…</div>
        </div>

        <div class="tab-pane fade show active" id="pane-suroviny" role="tabpanel">
          <div class="d-flex flex-wrap justify-content-between align-items-end gap-2 mb-3">
            <div class="flex-grow-1">
              <label for="sur-search" class="form-label mb-1">Vyhledat surovinu</label>
              <input type="text" class="form-control" id="sur-search" placeholder="Zadejte část názvu nebo čísla…">
            </div>
            <div>
              <label class="form-label mb-1 d-block">Filtrovat olej</label>
              <select id="sur-filter-olej" class="form-select">
                <option value="">Vše</option>
                <option value="1">Jen olejové</option>
                <option value="0">Bez oleje</option>
              </select>
            </div>
            <div>
              <label class="form-label mb-1 d-block" for="sur-filter-platnost">Platnost k datu</label>
              <input type="date" class="form-control" id="sur-filter-platnost" placeholder="YYYY-MM-DD">
            </div>
            <div>
              <label class="form-label mb-1 d-block">Záznamů na stránku</label>
              <select id="sur-limit" class="form-select">
                <option>10</option>
                <option>25</option>
                <option selected>50</option>
                <option>100</option>
              </select>
            </div>
            <div class="ms-auto d-flex gap-2">
              <button type="button" id="sur-reset" class="btn btn-outline-secondary">Reset filtrů</button>
              <button type="button" id="sur-export" class="btn btn-outline-secondary">Export CSV</button>
              <button type="button" id="sur-new" class="btn btn-success">Nová surovina</button>
            </div>
          </div>

          <div class="table-responsive">
            <table class="table table-sm table-hover table-striped align-middle" id="sur-table">
              <thead>
                <tr>
                  <th scope="col" data-col="id" class="sortable">ID</th>
                  <th scope="col" data-col="cislo" class="sortable">Číslo</th>
                  <th scope="col" data-col="nazev" class="sortable">Název</th>
                  <th scope="col" data-col="sh" class="sortable">SH</th>
                  <th scope="col" data-col="okp" class="sortable">OKP</th>
                  <th scope="col" data-col="olej" class="sortable">Olej</th>
                  <th scope="col">Pozn.</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div class="d-flex justify-content-between align-items-center mt-2">
            <div class="small text-muted" id="sur-summary">—</div>
            <div class="btn-group" role="group">
              <button class="btn btn-outline-secondary btn-sm" id="sur-prev">&laquo; Předchozí</button>
              <button class="btn btn-outline-secondary btn-sm" id="sur-next">Další &raquo;</button>
            </div>
          </div>
        </div>
      
        <div class="tab-pane fade" id="pane-pol" role="tabpanel">
          <div class="d-flex flex-wrap justify-content-between align-items-end gap-2 mb-3">
            <div class="flex-grow-1">
              <label for="pol-search" class="form-label mb-1">Vyhledat polotovar</label>
              <input type="text" class="form-control" id="pol-search" placeholder="Zadejte část názvu nebo čísla…">
            </div>
            <div>
              <label class="form-label mb-1 d-block">Záznamů na stránku</label>
              <select id="pol-limit" class="form-select">
                <option>10</option>
                <option>25</option>
                <option selected>50</option>
                <option>100</option>
              </select>
            </div>
            <div class="ms-auto">
              <button id="pol-new" class="btn btn-success">Nový polotovar</button>
            </div>
          </div>

          <div class="table-responsive">
            <table class="table table-sm table-hover table-striped align-middle" id="pol-table">
              <thead>
                <tr>
                  <th scope="col" data-col="id" class="sortable">ID</th>
                  <th scope="col" data-col="cislo" class="sortable">Číslo</th>
                  <th scope="col" data-col="nazev" class="sortable">Název</th>
                  <th scope="col" data-col="sh" class="sortable">SH</th>
                  <th scope="col" data-col="okp" class="sortable">OKP</th>
                  <th scope="col" data-col="olej" class="sortable">Olej</th>
                  <th scope="col">Pozn.</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div class="d-flex justify-content-between align-items-center mt-2">
            <div class="small text-muted" id="pol-summary">—</div>
            <div class="btn-group" role="group">
              <button class="btn btn-outline-secondary btn-sm" id="pol-prev">&laquo; Předchozí</button>
              <button class="btn btn-outline-secondary btn-sm" id="pol-next">Další &raquo;</button>
            </div>
          </div>
        </div>

    </div>
  </div>

  <div class="text-end mt-3">
    <a href="./diag.html" class="link-secondary small">Diagnostika přihlášení</a>
  </div>

  <!-- Row action modal (polotovary) -->
  <?php if (file_exists(__DIR__."/pol.row-modal.html")) { include __DIR__."/pol.row-modal.html"; } ?>

<div class="modal fade" id="surModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
          <h5 class="modal-title">Detail suroviny</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Zavřít"></button>
      </div>
      <div class="modal-body">
<div id="vp-agg-wrap" class="mb-2" style="display:none;">
  <div class="alert alert-secondary py-2">
    <strong>Součet surovin (rekurzivně):</strong>
    <div class="table-responsive mt-2">
      <table class="table table-sm" id="vp-agg-table">
        <thead><tr><th>Číslo</th><th>Název</th><th class="text-end">Celkem navážit (g)</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>
        <form id="sur-form" class="row g-3">
          <div class="col-3"><label class="form-label">ID</label><input type="number" class="form-control" id="f-id" disabled></div>
          <div class="col-4"><label class="form-label">Číslo</label><input type="text" class="form-control" id="f-cislo" disabled></div>
          <div class="col-5"><label class="form-label">Název</label><input type="text" class="form-control" id="f-nazev" disabled></div>
          <div class="col-3"><label class="form-label">SH</label><input type="number" step="0.001" class="form-control" id="f-sh" disabled></div>
          <div class="col-3"><label class="form-label">Sušina (sh)</label><input type="number" step="0.001" class="form-control" id="f-sus_sh" disabled></div>
          <div class="col-3"><label class="form-label">Sušina (hmot.)</label><input type="number" step="0.001" class="form-control" id="f-sus_hmot" disabled></div>
          <div class="col-3"><label class="form-label">Sušina (obj.)</label><input type="number" step="0.001" class="form-control" id="f-sus_obj" disabled></div>
          <div class="col-3"><label class="form-label">OKP</label><input type="number" step="0.001" class="form-control" id="f-okp" disabled></div>
          <div class="col-3"><label class="form-label">Olej</label><input type="number" class="form-control" id="f-olej" disabled></div>
          <div class="col-6"><label class="form-label">Poznámka</label><input type="text" class="form-control" id="f-pozn" disabled></div>
          <div class="col-6"><label class="form-label">Datum od (dtod)</label><input type="date" class="form-control" id="f-dtod" disabled></div>
          <div class="col-6"><label class="form-label">Datum do (dtdo)</label><input type="date" class="form-control" id="f-dtdo" disabled></div>
        </form>
      </div>
      <div class="modal-footer justify-content-between">
        <div class="text-muted small" id="sur-meta"></div>
        <div class="d-flex gap-2">
          <button type="button" class="btn btn-outline-danger me-auto" id="btn-sur-delete">Smazat</button>
          <button type="button" class="btn btn-outline-secondary" id="btn-sur-clone">Klonovat</button>
          <button type="button" class="btn btn-outline-primary" id="btn-sur-edit">Editovat</button>
          <button type="button" class="btn btn-primary d-none" id="btn-sur-save">Uložit</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
  <div class="ms-auto btn-toolbar" id="vp-actions" role="toolbar"></div><h5 class="modal-title">Přihlášení</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Zavřít"></button></div>
      <div class="modal-body">
<div id="vp-agg-wrap" class="mb-2" style="display:none;">
  <div class="alert alert-secondary py-2">
    <strong>Součet surovin (rekurzivně):</strong>
    <div class="table-responsive mt-2">
      <table class="table table-sm" id="vp-agg-table">
        <thead><tr><th>Číslo</th><th>Název</th><th class="text-end">Celkem navážit (g)</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>
        <form id="login-form">
          <div class="mb-3"><label class="form-label">Uživatel</label><input type="text" class="form-control" id="login-username" autocomplete="username"></div>
          <div class="mb-3"><label class="form-label">Heslo</label><input type="password" class="form-control" id="login-password" autocomplete="current-password"></div>
          <div class="form-text">Token se uloží do localStorage. Server může navíc nastavit cookie <code>balp_token</code>.</div>
        </form>
      </div>
      <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Zavřít</button><button type="button" class="btn btn-primary" id="login-submit">Přihlásit</button></div>
    </div>
  </div>
</div>

<script>window.API_URL = window.API_URL || '/balp2/api.php';</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="./js/app.js"></script>
<script src="./js/pol.controller.patch.js"></script>
<!-- Výrobní příkaz modal (auto-injected) -->
<div class="modal fade" id="vpModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
          <h5 class="modal-title">Výrobní příkaz</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Zavřít"></button>
      </div>
      <div class="modal-body">
<div id="vp-agg-wrap" class="mb-2" style="display:none;">
  <div class="alert alert-secondary py-2">
    <strong>Součet surovin (rekurzivně):</strong>
    <div class="table-responsive mt-2">
      <table class="table table-sm" id="vp-agg-table">
        <thead><tr><th>Číslo</th><th>Název</th><th class="text-end">Celkem navážit (g)</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>
        <div class="row g-3 align-items-end">
          <div class="col-md-4">
            <label class="form-label">Polotovar</label>
            <input type="text" class="form-control" id="vp-pol-head" disabled>
          </div>
          <div class="col-md-3">
            <label class="form-label">Vyrobit (kg)</label>
            <input type="number" step="0.01" min="0.01" class="form-control" id="vp-mnozstvi" value="1.00">
          </div>
          <div class="col-md-5"></div>
</div>
         <div class="row mt-2">
           <div class="col">
             <div id="vp-actions-bottom" class="btn-toolbar gap-2 flex-wrap"></div>
           </div>
         </div>
    
        <div id="vp-summary" class="row g-3 mt-2">
  <div class="col-md-3"><small class="text-muted d-block">Poznámka</small><div id="vp-poznamka" class="fw-medium text-truncate"></div></div>
  <div class="col-md-2"><small class="text-muted d-block">Specifická hmotnost (skutečná)</small><div id="vp-sh-skut" class="fw-medium"></div></div>
  <div class="col-md-2"><small class="text-muted d-block">Specifická hmotnost (spočítaná)</small><div id="vp-sh-calc" class="fw-medium"></div></div>
  <div class="col-md-2"><small class="text-muted d-block">Sušina — hmotnost (%)</small><div id="vp-sus-hmot" class="fw-medium"></div></div>
  <div class="col-md-2"><small class="text-muted d-block">Sušina — objem (%)</small><div id="vp-sus-obj" class="fw-medium"></div></div>
</div>
<hr>
        
      <ul class="nav nav-tabs" id="vpTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="vp-sur-tab" data-bs-toggle="tab" data-bs-target="#vp-tab-sur" type="button" role="tab">Suroviny</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="vp-pol-tab" data-bs-toggle="tab" data-bs-target="#vp-tab-pol" type="button" role="tab">Polotovary</button>
        </li>
        <li class="nav-item"><a class="nav-link" href="../admin_users.php">Uživatelé</a></li>
</ul>
      <div class="tab-content mt-2">
        <div class="tab-pane fade show active" id="vp-tab-sur" role="tabpanel" aria-labelledby="vp-sur-tab">
          <div class="table-responsive">
            <table class="table table-sm table-striped" id="vp-table-sur">
              <thead><tr><th>Tech. poř.</th><th>Číslo</th><th>Název</th><th>Platnost od</th><th>Platnost do</th><th class="text-end">SH</th><th class="text-end">Suš.hm %</th><th class="text-end">Suš.obj %</th><th class="text-end">g / kg</th><th class="text-end">Navážit (g)</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
        <div class="tab-pane fade" id="vp-tab-pol" role="tabpanel" aria-labelledby="vp-pol-tab">
          <div class="table-responsive">
            <table class="table table-sm table-striped" id="vp-table-pol">
              <thead><tr><th>Tech. poř.</th><th>Číslo</th><th>Název</th><th>Platnost od</th><th>Platnost do</th><th class="text-end">SH</th><th class="text-end">Suš.hm %</th><th class="text-end">Suš.obj %</th><th class="text-end">g / kg</th><th class="text-end">Navážit (g)</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Zavřít</button>
      </div>
    </div>
  </div>
</div>
<script src="js/pol.vyrobni-prikaz.js"></script>
<script src="js/pol.row-open.js"></script>
<script src="js/pol.vp.core.js"></script>
<!-- Editor receptury (polotovary) -->
<div class="modal fade" id="polEditorModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
          <h5 class="modal-title">Editor receptury</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Zavřít"></button>
      </div>
      <div class="modal-body">
<div id="vp-agg-wrap" class="mb-2" style="display:none;">
  <div class="alert alert-secondary py-2">
    <strong>Součet surovin (rekurzivně):</strong>
    <div class="table-responsive mt-2">
      <table class="table table-sm" id="vp-agg-table">
        <thead><tr><th>Číslo</th><th>Název</th><th class="text-end">Celkem navážit (g)</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>
        <form id="pol-edit-form" onsubmit="return false;">
          <div class="row g-3">
            <div class="col-md-2"><label class="form-label">ID</label><input id="pe-id" class="form-control" disabled></div>
            <div class="col-md-3"><label class="form-label">Číslo</label><input id="pe-cislo" class="form-control"></div>
            <div class="col-md-4"><label class="form-label">Název</label><input id="pe-nazev" class="form-control"></div>
            <div class="col-md-1"><label class="form-label">SH</label><input id="pe-sh" class="form-control"></div>
            <div class="col-md-1"><label class="form-label">OKP</label><input id="pe-okp" class="form-control"></div>
            <div class="col-md-1"><label class="form-label">Olej</label><input id="pe-olej" class="form-control"></div>
            <div class="col-12"><label class="form-label">Poznámka</label><input id="pe-poz" class="form-control"></div>
          </div>
          <div id="vp-summary" class="row g-3 mt-2">
  <div class="col-md-3"><small class="text-muted d-block">Poznámka</small><div id="vp-poznamka" class="fw-medium text-truncate"></div></div>
  <div class="col-md-2"><small class="text-muted d-block">Specifická hmotnost (skutečná)</small><div id="vp-sh-skut" class="fw-medium"></div></div>
  <div class="col-md-2"><small class="text-muted d-block">Specifická hmotnost (spočítaná)</small><div id="vp-sh-calc" class="fw-medium"></div></div>
  <div class="col-md-2"><small class="text-muted d-block">Sušina — hmotnost (%)</small><div id="vp-sus-hmot" class="fw-medium"></div></div>
  <div class="col-md-2"><small class="text-muted d-block">Sušina — objem (%)</small><div id="vp-sus-obj" class="fw-medium"></div></div>
</div>
<hr>
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="mb-0">Položky receptury</h6>
            <div class="btn-group">
              <button class="btn btn-sm btn-outline-primary" id="pe-add-sur">Přidat surovinu</button>
              <button class="btn btn-sm btn-outline-secondary" id="pe-add-pol">Přidat polotovar</button>
            </div>
          </div>
          <div class="table-responsive">
            <table class="table table-sm align-middle" id="pe-table">
              <thead><tr><th>Typ</th><th>Kód / název</th><th>Tech.poř.</th><th class="text-end">g / kg</th><th></th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <div class="me-auto">
          <button class="btn btn-outline-danger" id="pe-delete">Smazat</button>
          <button class="btn btn-outline-secondary" id="pe-clone">Klonovat</button>
        </div>
        <button class="btn btn-secondary" data-bs-dismiss="modal">Zavřít</button>
        <button class="btn btn-primary" id="pe-save">Uložit</button>
      </div>
    </div>
  </div>
</div>
<script src="js/pol.editor.js"></script>
  <script src="./js/pol.row-modal.js"></script>
</body>
</html>
